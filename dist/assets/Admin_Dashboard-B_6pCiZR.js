import{_ as re,r,w as ie,c as R,u as ue,o as de,a as o,b as e,d as ce,e as me,f as ve,S as pe,g as i,t as l,F as ge,h as he,i as L,n as N,j as O,k as ke,v as _e,B as fe,C as J,A as K,l as be,J as ye,m as we,p as n}from"./index-Bo9iFZkA.js";const Te={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},Ae={class:"topbar"},Se={class:"container dashboard"},Re={key:0,class:"summary-grid"},Ce={class:"summary-card"},Pe={class:"value"},Me={class:"summary-card"},Ee={class:"value"},Oe={class:"summary-card"},$e={class:"value"},Ie={class:"summary-card"},xe={class:"value"},Be={class:"summary-card"},Le={class:"value"},Ne={key:1,class:"table-section"},De={class:"table-header"},We=["disabled"],Ve={key:0,class:"error"},je={key:1,class:"empty"},Fe={key:2,class:"table-wrapper"},He={class:"table"},Ge={class:"cell-title"},Ue={class:"title"},ze={class:"sub"},Je={class:"mono"},Ke={key:2,class:"promoter-section"},Xe={key:0,class:"error"},Qe={key:1,class:"promoter-meta"},Ye={class:"row"},qe=["href"],Ze={key:0,class:"row"},et=["href"],tt={key:1,class:"hint"},at={class:"promoter-form"},st={class:"promoter-actions"},lt=["disabled"],ot=["disabled"],nt=["disabled"],rt={key:0,class:"error"},it={key:1,class:"ok"},ut={key:2,class:"promoter-result"},dt={class:"row"},ct=["href"],mt={key:0,class:"row"},vt={key:1,class:"row"},pt=["href"],gt={key:3,class:"forbidden"},$="https://amoy.polygonscan.com",ht={__name:"Admin_Dashboard",setup(kt){const X=we(),b=r(!1),Q=()=>b.value=!b.value;ie(()=>X.fullPath,()=>b.value=!1);const{account:D,ensureChain:Y}=ue(),y="0xd0c718240519a2a843F2c9d2A8321ADD9caa1F15",q="https://rpc-amoy.polygon.technology",C=r(""),h=r(""),w=r(null),P=r(!1),d=r(""),T=r(!1),v=r(""),p=r(""),g=r(""),M=r(""),Z=R(()=>h.value?`${$}/address/${h.value}`:""),ee=R(()=>p.value?`${$}/tx/${p.value}`:""),I=R(()=>!g.value||!D.value?!1:String(g.value).toLowerCase()===String(D.value).toLowerCase());function W(a){const t=String(a||"").trim();if(!t)return"";try{return be(t)}catch{return""}}let E=null;function te(){return E||(E=new ye(q),E)}function V(){return new J(y,K,te())}async function ae(){M.value="",g.value="";try{const t=await V().owner();g.value=String(t||"")}catch(a){console.error(a),M.value=a?.message||"Gagal mengambil owner kontrak."}}async function j(){d.value="",v.value="",p.value="",w.value=null;const a=W(C.value);if(h.value=a,!a){d.value="Alamat wallet tidak valid.";return}P.value=!0;try{const s=await V().isPromoter(a);w.value=!!s}catch(t){console.error(t),d.value=t?.reason||t?.message||"Gagal memeriksa status promoter."}finally{P.value=!1}}async function F(a){d.value="",v.value="",p.value="";const t=W(C.value);if(h.value=t,!t){d.value="Alamat wallet tidak valid.";return}if(!window?.ethereum){d.value="MetaMask tidak terdeteksi. Untuk menambah/menghapus promoter, Anda harus memakai MetaMask.";return}const s=!!a,u=s?"menambahkan":"menghapus";if(window.confirm(`Konfirmasi: ${u} promoter untuk wallet
${t}

Transaksi akan muncul di MetaMask.`)){T.value=!0;try{await Y("amoy");const f=await new fe(window.ethereum).getSigner(),z=await new J(y,K,f).setPromoter(t,s);p.value=z?.hash||"",v.value="Transaksi dikirim. Menunggu konfirmasi…",await z.wait(),v.value="Berhasil. Status promoter sudah diperbarui di blockchain.",await j()}catch(m){console.error(m),v.value="",d.value=m?.reason||m?.shortMessage||m?.message||"Transaksi gagal."}finally{T.value=!1}}}const se="http://localhost:3001".replace(/\/+$/,"").replace(/\/api$/i,""),le=()=>(localStorage.getItem("walletAddress")||"").toString();async function H(a,t={}){const s=a.startsWith("/api")?a:`/api${a.startsWith("/")?a:`/${a}`}`,u=await fetch(`${se}${s}`,{...t,headers:{"content-type":"application/json",...t.headers||{},"x-wallet-address":le()}}),c=await u.json().catch(()=>({}));if(!u.ok)throw new Error(c?.error||c?.message||`HTTP ${u.status}`);return c}function x(a){return a?String(Math.round(a)).replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function oe(a){if(!a)return"-";const t=new Date(a);return Number.isFinite(t.getTime())?t.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):a}const k=r("customer"),_=r(!1),A=r(""),G=r([]),B=R(()=>G.value.map(a=>{const t=Number(a.sold_tickets||0),s=Number(a.total_tickets||0),u=Number(a.price_idr||0),c=t*u;return{id:a.id,title:a.title,venue:a.venue,dateLabel:oe(a.date_iso),sold:t,total:s,remaining:Math.max(s-t,0),priceIdr:u,revenueIdr:c,listed:!!a.listed,promoterWallet:a.promoter_wallet||null}})),S=R(()=>{const a=B.value,t=a.length;let s=0,u=0,c=0,m=0;for(const f of a)s+=f.total,u+=f.sold,c+=f.remaining,m+=f.revenueIdr;return{totalEvents:t,totalTickets:s,totalSold:u,totalRemaining:c,totalRevenueIdr:m}});async function ne(){try{const a=await H("/api/me");k.value=a?.role||"customer"}catch(a){console.error(a),A.value=a.message||"Gagal mengambil role user"}}async function U(){_.value=!0,A.value="";try{const a=await H("/api/events?all=1&include_unlisted=1");G.value=Array.isArray(a?.items)?a.items:[]}catch(a){console.error(a),A.value=a.message||"Gagal memuat data event"}finally{_.value=!1}}return de(async()=>{await ne(),k.value==="admin"&&(await U(),await ae())}),(a,t)=>(n(),o("div",Te,[e("header",Ae,[t[5]||(t[5]=e("div",{class:"brand"},[e("img",{src:me,alt:"Tickety"})],-1)),t[6]||(t[6]=e("div",{class:"topbar-title"},"Admin Dashboard",-1)),e("button",{class:"hamburger",onClick:ve(Q,["stop"]),"aria-label":"Toggle Sidebar"},[...t[4]||(t[4]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])]),ce(pe,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s)},null,8,["modelValue"]),e("main",Se,[t[23]||(t[23]=e("section",{class:"hero hero--compact"},[e("div",{class:"hero-text"},[e("p",{class:"badge"},"Admin"),e("h1",null,"Ringkasan Penjualan Tiket"),e("p",{class:"muted"},"Pantau performa semua event yang terdaftar di platform.")])],-1)),k.value==="admin"?(n(),o("section",Re,[e("article",Ce,[t[7]||(t[7]=e("p",{class:"label"},"Total Event",-1)),e("p",Pe,l(S.value.totalEvents),1)]),e("article",Me,[t[8]||(t[8]=e("p",{class:"label"},"Total Tiket",-1)),e("p",Ee,l(S.value.totalTickets),1)]),e("article",Oe,[t[9]||(t[9]=e("p",{class:"label"},"Tiket Terjual",-1)),e("p",$e,l(S.value.totalSold),1)]),e("article",Ie,[t[10]||(t[10]=e("p",{class:"label"},"Tiket Tersisa",-1)),e("p",xe,l(S.value.totalRemaining),1)]),e("article",Be,[t[11]||(t[11]=e("p",{class:"label"},"Perkiraan Pendapatan",-1)),e("p",Le," Rp "+l(x(S.value.totalRevenueIdr)||"0"),1)])])):i("",!0),k.value==="admin"?(n(),o("section",Ne,[e("header",De,[t[12]||(t[12]=e("h2",null,"Detail Event",-1)),e("button",{class:"refresh",onClick:U,disabled:_.value},l(_.value?"Memuat…":"Refresh"),9,We)]),A.value?(n(),o("p",Ve,l(A.value),1)):i("",!0),!_.value&&B.value.length===0?(n(),o("div",je," Belum ada event yang tercatat. ")):(n(),o("div",Fe,[e("table",He,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Event"),e("th",null,"Tanggal"),e("th",null,"Terjual / Total"),e("th",null,"Sisa"),e("th",null,"Harga (Rp)"),e("th",null,"Pendapatan (Rp)"),e("th",null,"Status"),e("th",null,"Promoter")])],-1)),e("tbody",null,[(n(!0),o(ge,null,he(B.value,s=>(n(),o("tr",{key:s.id},[e("td",null,[e("div",Ge,[e("div",Ue,l(s.title),1),e("div",ze,l(s.venue),1)])]),e("td",null,l(s.dateLabel),1),e("td",null,l(s.sold)+" / "+l(s.total),1),e("td",null,l(s.remaining),1),e("td",null,"Rp "+l(x(s.priceIdr)||"0"),1),e("td",null,"Rp "+l(x(s.revenueIdr)||"0"),1),e("td",null,[e("span",{class:N(["pill",s.listed?"pill--green":"pill--gray"])},l(s.listed?"Listed":"Unlisted"),3)]),e("td",null,[e("span",Je,l(s.promoterWallet||"-"),1)])]))),128))])])]))])):i("",!0),k.value==="admin"?(n(),o("section",Ke,[t[21]||(t[21]=e("header",{class:"table-header"},[e("h2",null,"Manajemen Promoter (On-chain)")],-1)),M.value?(n(),o("p",Xe,l(M.value),1)):i("",!0),L(y)?(n(),o("div",Qe,[e("div",Ye,[t[14]||(t[14]=e("span",{class:"k"},"Contract",-1)),e("a",{class:"mono link",href:`${$}/address/${L(y)}`,target:"_blank",rel:"noreferrer"},l(L(y)),9,qe)]),g.value?(n(),o("div",Ze,[t[15]||(t[15]=e("span",{class:"k"},"Owner",-1)),e("a",{class:"mono link",href:`${$}/address/${g.value}`,target:"_blank",rel:"noreferrer"},l(g.value),9,et),e("span",{class:N(["pill",I.value?"pill--green":"pill--gray"])},l(I.value?"Wallet Admin = Owner":"Wallet Admin ≠ Owner"),3)])):i("",!0),I.value?i("",!0):(n(),o("p",tt,[...t[16]||(t[16]=[O(" Catatan: fungsi ",-1),e("span",{class:"mono"},"setPromoter",-1),O(" biasanya hanya bisa dipanggil oleh ",-1),e("span",{class:"mono"},"owner",-1),O(". Jika wallet admin Anda bukan owner, transaksi kemungkinan ",-1),e("span",{class:"mono"},"revert",-1),O(". ",-1)])]))])):i("",!0),e("div",at,[t[20]||(t[20]=e("label",{class:"lbl"},"Wallet Address",-1)),ke(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>C.value=s),class:"inp mono",placeholder:"0x...",autocomplete:"off",spellcheck:"false"},null,512),[[_e,C.value]]),e("div",st,[e("button",{class:"btn primary",onClick:j,disabled:P.value},l(P.value?"Checking…":"Check"),9,lt),e("button",{class:"btn primary",onClick:t[2]||(t[2]=s=>F(!0)),disabled:T.value},l(T.value?"Processing…":"Add Promoter"),9,ot),e("button",{class:"btn ghost",onClick:t[3]||(t[3]=s=>F(!1)),disabled:T.value}," Remove Promoter ",8,nt)]),d.value?(n(),o("p",rt,l(d.value),1)):i("",!0),v.value?(n(),o("p",it,l(v.value),1)):i("",!0),h.value?(n(),o("div",ut,[e("div",dt,[t[17]||(t[17]=e("span",{class:"k"},"Address",-1)),e("a",{class:"mono link",href:Z.value,target:"_blank",rel:"noreferrer"},l(h.value),9,ct)]),w.value!==null?(n(),o("div",mt,[t[18]||(t[18]=e("span",{class:"k"},"Status",-1)),e("span",{class:N(["pill",w.value?"pill--green":"pill--gray"])},l(w.value?"PROMOTER":"NOT PROMOTER"),3)])):i("",!0),p.value?(n(),o("div",vt,[t[19]||(t[19]=e("span",{class:"k"},"Tx",-1)),e("a",{class:"mono link",href:ee.value,target:"_blank",rel:"noreferrer"},l(p.value),9,pt)])):i("",!0)])):i("",!0)])])):i("",!0),k.value!=="admin"&&!_.value?(n(),o("section",gt,[...t[22]||(t[22]=[e("p",{class:"error"},"Halaman ini hanya untuk admin.",-1)])])):i("",!0)])]))}},yt=re(ht,[["__scopeId","data-v-ee3e7be9"]]);export{yt as default};
