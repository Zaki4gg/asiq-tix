import{_ as ne,c as $,o as z,a as Y,w as R,b as p,d as t,e as _,f as y,u as k,R as b,g as se,n as oe,h as F,i as m,j as C,r as u,k as le,t as v,F as ie,l as re,m as de,p as ce,q as ue}from"./index-B7XfvEUy.js";const ve={class:"mini-nav","aria-label":"Main"},we={__name:"DrawerNav",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(N,{emit:x}){const E=N,w=x,P=F(),d=$({get:()=>E.modelValue,set:h=>w("update:modelValue",h)});function n(){d.value=!1}function I(h){h.key==="Escape"&&n()}return z(()=>window.addEventListener("keydown",I)),Y(()=>window.removeEventListener("keydown",I)),R(()=>P.fullPath,n),(h,l)=>(m(),p("div",{class:oe(["drawer",{"is-open":d.value}]),"aria-hidden":"true"},[t("div",{class:"drawer-backdrop",onClick:n}),t("div",{class:"drawer-panel",role:"dialog","aria-modal":"true",onClick:l[0]||(l[0]=se(()=>{},["stop"]))},[t("nav",ve,[_(k(b),{class:"link","active-class":"active",to:"/home",onClick:n},{default:y(()=>[...l[1]||(l[1]=[C("Home",-1)])]),_:1}),_(k(b),{class:"link","active-class":"active",to:"/profile",onClick:n},{default:y(()=>[...l[2]||(l[2]=[C("Profile",-1)])]),_:1}),_(k(b),{class:"link","active-class":"active",to:"/wallet",onClick:n},{default:y(()=>[...l[3]||(l[3]=[C("Wallet",-1)])]),_:1}),_(k(b),{class:"link","active-class":"active",to:"/history",onClick:n},{default:y(()=>[...l[4]||(l[4]=[C("History",-1)])]),_:1}),_(k(b),{class:"link-btn",to:"/logout",onClick:n},{default:y(()=>[...l[5]||(l[5]=[C("Log out",-1)])]),_:1})])])],2))}},he=ne(we,[["__scopeId","data-v-bb970d53"]]),fe=`<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="980.000000pt" height="980.000000pt" viewBox="0 0 980.000000 980.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,980.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M4615 8269 c-609 -52 -1208 -276 -1705 -637 -636 -464 -1104 -1158
-1290 -1916 -191 -777 -102 -1601 250 -2306 405 -813 1101 -1424 1950 -1712
562 -190 1172 -228 1760 -108 1651 337 2814 1872 2691 3550 -60 817 -404 1571
-977 2144 -535 535 -1200 864 -1954 967 -170 23 -554 33 -725 18z m575 -509
c562 -59 1089 -278 1535 -639 101 -82 331 -313 409 -411 346 -434 561 -951
622 -1490 16 -145 18 -462 4 -600 -40 -386 -167 -783 -356 -1114 -56 -97 -191
-303 -205 -312 -5 -3 -38 19 -72 48 -483 422 -1111 696 -1772 773 -166 20
-530 23 -685 6 -731 -80 -1368 -367 -1907 -858 l-79 -71 -49 61 c-27 34 -83
111 -123 171 -233 349 -375 704 -449 1124 -26 149 -28 173 -27 457 0 328 10
423 74 684 179 727 641 1360 1284 1758 353 218 759 359 1176 408 130 15 492
18 620 5z"/>
<path d="M4780 6609 c-322 -57 -603 -266 -747 -554 -37 -73 -78 -199 -92 -279
-16 -85 -13 -282 3 -368 77 -391 360 -691 754 -800 64 -18 106 -22 247 -22
148 -1 181 2 255 22 521 142 846 643 755 1163 -68 393 -355 709 -737 815 -75
21 -121 26 -238 29 -80 2 -170 0 -200 -6z"/>
</g>
</svg>
`,pe={class:"profile-page"},me={class:"content"},_e={class:"grid"},ge={class:"profile-card"},ye={class:"avatar"},ke=["innerHTML"],Ce={class:"profile-meta"},be={class:"addr"},Ie={class:"wallet-mini"},Le={class:"acc"},Se=["disabled"],De={class:"history-card"},xe={key:0,class:"alert error",style:{margin:"10px 0"}},Ee={key:1,class:"alert",style:{margin:"10px 0"}},Pe={key:2},Te={class:"table"},Ae={"data-col":"Concert(s)"},Be={"data-col":"Payment Date"},Me={"data-col":"Price"},Ve={"data-col":"Status"},He={"data-col":"Action"},Oe=["disabled","onClick"],$e={class:"see-all"},Ne={__name:"Profile",setup(N){const x=F(),E=ue(),w=u(!1),P=()=>w.value=!w.value;R(()=>x.fullPath,()=>w.value=!1);const{account:d}=le(),n=$(()=>d.value||"");async function I(){if(!d.value&&window?.ethereum)try{const e=await window.ethereum.request({method:"eth_accounts"});e?.[0]&&(d.value=e[0])}catch{}}function h(e){d.value=e?.[0]||"",d.value?(V(),g(),M()):(H(),L.value=0n,f.value=[])}const l=u("0x0"),G=u("ETH"),L=u(0n),j=e=>e===137||e===80002?"POL":"ETH";async function T(){if(window?.ethereum)try{const e=await window.ethereum.request({method:"eth_chainId"});l.value=e,G.value=j(Number(e))}catch{}}async function g(){if(!window?.ethereum||!d.value){L.value=0n;return}try{const e=await window.ethereum.request({method:"eth_getBalance",params:[d.value,"latest"]});L.value=BigInt(e)}catch{L.value=0n}}function U(){T(),g()}const q="http://localhost:3001".replace(/\/+$/,"");async function A(e,a){const r=e.startsWith("http")?e:`${q}${e}`,o={"x-wallet-address":n.value.toLowerCase()},i=await fetch(r,{...a,headers:o}),c=await i.text().catch(()=>"");let s=null;try{s=c?JSON.parse(c):null}catch{s={message:c}}if(!i.ok)throw new Error(s?.error||s?.message||"Request failed");return s}const f=u([]),B=u(!1),S=u(""),J=e=>{try{return new Date(e).toISOString().slice(0,10)}catch{return""}},K=e=>"Rp "+Math.abs(Number(e)||0).toLocaleString("id-ID");function W(e){return{id:e.id,eventId:e.ref_id||null,event:e.event_title||null,date:J(e.created_at||Date.now()),price:K(e.amount),status:(e.status||"confirmed").replace(/^./,a=>a.toUpperCase())}}async function M(){if(S.value="",!n.value){f.value=[];return}try{B.value=!0;const e=await A("/transactions");let r=(Array.isArray(e)?e:[]).filter(i=>(i.kind||"").toLowerCase()==="purchase").map(W);const o=[...new Set(r.filter(i=>i.eventId&&!i.event).map(i=>i.eventId))];if(o.length){const i=await Promise.allSettled(o.map(s=>A(`/api/events/${s}`))),c={};i.forEach((s,ae)=>{s.status==="fulfilled"&&s.value&&(c[o[ae]]=s.value?.title||"(Unlisted)")}),r.forEach(s=>{!s.event&&s.eventId&&c[s.eventId]&&(s.event=c[s.eventId])})}r.sort((i,c)=>new Date(c.date)-new Date(i.date)),f.value=r.slice(0,3)}catch(e){S.value=String(e?.message||e),f.value=[]}finally{B.value=!1}}let D=null;function V(){H(),n.value&&(D=ce(q,{transports:["websocket"],auth:{address:n.value.toLowerCase()}}),D.on("tx:new",e=>{if((e?.wallet||"").toLowerCase()===n.value.toLowerCase()&&(g(),(e.kind||"").toLowerCase()==="purchase")){const a=W(e);!a.event&&a.eventId&&A(`/events/${a.eventId}`).then(r=>{a.event=r?.title||a.event||"(Unlisted)"}).catch(()=>{}),f.value.findIndex(r=>r.id===a.id)===-1&&f.value.unshift(a)}}))}function H(){D?.disconnect?.(),D=null}const Q=u(""),X=u(""),Z=e=>e?`${e.slice(0,6)}…${e.slice(-4)}`:"";function ee(){n.value&&(navigator.clipboard.writeText(n.value),alert("Wallet address copied."))}const te=$(()=>fe);let O=null;return z(async()=>{await I(),await T(),await g(),await M(),n.value&&V(),window?.ethereum?.on&&(window.ethereum.on("accountsChanged",h),window.ethereum.on("chainChanged",U)),O=window.setInterval(g,15e3)}),Y(()=>{window?.ethereum?.removeListener&&(window.ethereum.removeListener("accountsChanged",h),window.ethereum.removeListener("chainChanged",U)),O&&clearInterval(O),H()}),R(d,async()=>{await T(),await g(),await M(),n.value&&V()}),(e,a)=>{const r=de("router-link");return m(),p("div",pe,[t("header",{class:"header"},[a[2]||(a[2]=t("h1",{class:"sr-only"},"Profile",-1)),t("button",{class:"hamburger",type:"button","aria-label":"Toggle sidebar",onClick:P},[...a[1]||(a[1]=[t("span",null,null,-1),t("span",null,null,-1),t("span",null,null,-1)])])]),_(he,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=o=>w.value=o)},null,8,["modelValue"]),t("div",me,[t("div",_e,[t("aside",ge,[t("div",ye,[t("div",{class:"avatar-svg",innerHTML:te.value},null,8,ke)]),t("div",Ce,[t("h3",null,v(Q.value),1),t("p",be,v(X.value),1)]),t("div",Ie,[a[3]||(a[3]=t("h3",null,"Wallet",-1)),t("p",Le,v(Z(n.value)||"-"),1),t("button",{class:"copy",disabled:!n.value,onClick:ee},"COPY",8,Se)])]),t("section",De,[a[6]||(a[6]=t("h2",null,"Purchase History",-1)),S.value?(m(),p("div",xe,v(S.value),1)):B.value?(m(),p("div",Ee,"Loading…")):(m(),p("div",Pe,[a[5]||(a[5]=t("div",{class:"thead"},[t("div",null,"Concert(s)"),t("div",null,"Payment Date"),t("div",null,"Price"),t("div",null,"Status"),t("div",null,"Action")],-1)),t("div",Te,[(m(!0),p(ie,null,re(f.value,o=>(m(),p("div",{class:"trow",key:o.id},[t("div",Ae,v(o.event||"(Unknown Event)"),1),t("div",Be,v(o.date),1),t("div",Me,v(o.price),1),t("div",Ve,v(o.status),1),t("div",He,[t("button",{class:"detail-btn",disabled:!o.eventId,onClick:i=>o.eventId&&k(E).push(`/events/${o.eventId}`)},"DETAIL",8,Oe)])]))),128))]),t("div",$e,[_(r,{to:"/history"},{default:y(()=>[...a[4]||(a[4]=[C(" Lihat semua riwayat tiket → ",-1)])]),_:1})])]))])])])])}}};export{Ne as default};
