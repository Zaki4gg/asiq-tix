import{_ as A,r as g,w as D,c as w,o as N,a as n,b as t,d as $,e as x,f as M,S as V,g as _,t as l,F as j,h as L,m as C,p as r,n as H}from"./index-CstXfXBD.js";const W={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},F={class:"topbar"},G={class:"container dashboard"},O={key:0,class:"summary-grid"},U={class:"summary-card"},z={class:"value"},q={class:"summary-card"},J={class:"value"},K={class:"summary-card"},Q={class:"value"},X={class:"summary-card"},Y={class:"value"},Z={class:"summary-card"},tt={class:"value"},et={key:1,class:"table-section"},at={class:"table-header"},st=["disabled"],lt={key:0,class:"error"},ot={key:1,class:"empty"},nt={key:2,class:"table-wrapper"},rt={class:"table"},it={class:"cell-title"},ut={class:"title"},dt={class:"sub"},ct={key:2,class:"forbidden"},mt={__name:"Promoter_Dashboard",setup(pt){const T=C(),d=g(!1),R=()=>d.value=!d.value;D(()=>T.fullPath,()=>d.value=!1);const I="http://localhost:3001".replace(/\/+$/,"").replace(/\/api$/i,""),E=()=>(localStorage.getItem("walletAddress")||"").toString();async function b(a,e={}){const s=a.startsWith("/api")?a:`/api${a.startsWith("/")?a:`/${a}`}`,o=await fetch(`${I}${s}`,{...e,headers:{"content-type":"application/json",...e.headers||{},"x-wallet-address":E()}}),i=await o.json().catch(()=>({}));if(!o.ok)throw new Error(i?.error||i?.message||`HTTP ${o.status}`);return i}function h(a){return a?String(Math.round(a)).replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function P(a){if(!a)return"-";const e=new Date(a);return Number.isFinite(e.getTime())?e.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):a}const c=g("customer"),u=g(!1),m=g(""),f=g([]),y=w(()=>f.value.map(a=>{const e=Number(a.sold_tickets||0),s=Number(a.total_tickets||0),o=Number(a.price_idr||0),i=e*o;return{id:a.id,title:a.title,venue:a.venue,dateLabel:P(a.date_iso),sold:e,total:s,remaining:Math.max(s-e,0),priceIdr:o,revenueIdr:i,listed:!!a.listed}})),p=w(()=>{const a=y.value,e=a.length;let s=0,o=0,i=0,S=0;for(const v of a)s+=v.total,o+=v.sold,i+=v.remaining,S+=v.revenueIdr;return{totalEvents:e,totalTickets:s,totalSold:o,totalRemaining:i,totalRevenueIdr:S}});async function B(){try{const a=await b("/api/me");c.value=a?.role||"customer"}catch(a){console.error(a),m.value=a.message||"Gagal mengambil role user"}}async function k(){u.value=!0,m.value="";try{const a=await b("/api/my-events");f.value=Array.isArray(a?.items)?a.items:[]}catch(a){console.error(a),m.value=a.message||"Gagal memuat data event"}finally{u.value=!1}}return N(async()=>{await B(),c.value==="promoter"&&await k()}),(a,e)=>(r(),n("div",W,[t("header",F,[e[2]||(e[2]=t("div",{class:"brand"},[t("img",{src:x,alt:"Tickety"})],-1)),e[3]||(e[3]=t("div",{class:"topbar-title"},"Promoter Dashboard",-1)),t("button",{class:"hamburger",onClick:M(R,["stop"]),"aria-label":"Toggle Sidebar"},[...e[1]||(e[1]=[t("span",null,null,-1),t("span",null,null,-1),t("span",null,null,-1)])])]),$(V,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s)},null,8,["modelValue"]),t("main",G,[e[12]||(e[12]=t("section",{class:"hero hero--compact"},[t("div",{class:"hero-text"},[t("p",{class:"badge"},"Promoter"),t("h1",null,"Penjualan Tiket Event Saya"),t("p",{class:"muted"},"Data hanya untuk event yang dibuat dengan wallet ini.")])],-1)),c.value==="promoter"?(r(),n("section",O,[t("article",U,[e[4]||(e[4]=t("p",{class:"label"},"Event Saya",-1)),t("p",z,l(p.value.totalEvents),1)]),t("article",q,[e[5]||(e[5]=t("p",{class:"label"},"Total Tiket",-1)),t("p",J,l(p.value.totalTickets),1)]),t("article",K,[e[6]||(e[6]=t("p",{class:"label"},"Tiket Terjual",-1)),t("p",Q,l(p.value.totalSold),1)]),t("article",X,[e[7]||(e[7]=t("p",{class:"label"},"Tiket Tersisa",-1)),t("p",Y,l(p.value.totalRemaining),1)]),t("article",Z,[e[8]||(e[8]=t("p",{class:"label"},"Perkiraan Pendapatan",-1)),t("p",tt," Rp "+l(h(p.value.totalRevenueIdr)||"0"),1)])])):_("",!0),c.value==="promoter"?(r(),n("section",et,[t("header",at,[e[9]||(e[9]=t("h2",null,"Event Saya",-1)),t("button",{class:"refresh",onClick:k,disabled:u.value},l(u.value?"Memuatâ€¦":"Refresh"),9,st)]),m.value?(r(),n("p",lt,l(m.value),1)):_("",!0),!u.value&&y.value.length===0?(r(),n("div",ot," Belum ada event yang dimiliki oleh wallet ini. ")):(r(),n("div",nt,[t("table",rt,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Tanggal"),t("th",null,"Terjual / Total"),t("th",null,"Sisa"),t("th",null,"Harga (Rp)"),t("th",null,"Pendapatan (Rp)"),t("th",null,"Status")])],-1)),t("tbody",null,[(r(!0),n(j,null,L(y.value,s=>(r(),n("tr",{key:s.id},[t("td",null,[t("div",it,[t("div",ut,l(s.title),1),t("div",dt,l(s.venue),1)])]),t("td",null,l(s.dateLabel),1),t("td",null,l(s.sold)+" / "+l(s.total),1),t("td",null,l(s.remaining),1),t("td",null,"Rp "+l(h(s.priceIdr)||"0"),1),t("td",null,"Rp "+l(h(s.revenueIdr)||"0"),1),t("td",null,[t("span",{class:H(["pill",s.listed?"pill--green":"pill--gray"])},l(s.listed?"Listed":"Unlisted"),3)])]))),128))])])]))])):_("",!0),c.value!=="promoter"&&!u.value?(r(),n("section",ct,[...e[11]||(e[11]=[t("p",{class:"error"},"Halaman ini hanya untuk promoter.",-1)])])):_("",!0)])]))}},_t=A(mt,[["__scopeId","data-v-e99a1994"]]);export{_t as default};
