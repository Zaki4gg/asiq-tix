import{_ as $,r as u,w as R,c as w,m as V,o as M,a as s,b as e,d as N,e as W,f as x,S as C,g as m,j as A,t as r,F as L,h as j,p as F,q as l}from"./index-Db4e0OL_.js";const H={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},q={class:"topbar"},G={class:"container dashboard"},O={class:"hero hero--compact"},U={class:"hero-text"},z={class:"muted"},J={key:0},K={key:0,class:"muted"},Q={class:"mono"},X={key:0,class:"table-section"},Y={class:"table-header"},Z=["disabled"],ee={key:0,class:"error"},te={key:1,class:"empty"},ae={key:2,class:"table-wrapper"},se={class:"table"},le={class:"mono"},ne={key:1,class:"forbidden"},oe={__name:"Admin_EventTransactions",setup(re){const b=V(),S=F(),d=u(!1),T=()=>d.value=!d.value;R(()=>b.fullPath,()=>d.value=!1);const B="http://localhost:3001,https://asiqtix-main-production.up.railway.app/".replace(/\/+$/,"").replace(/\/api$/i,""),I=()=>(localStorage.getItem("walletAddress")||"").toString();async function g(t,a={}){const o=t.startsWith("/api")?t:`/api${t.startsWith("/")?t:`/${t}`}`,h=await fetch(`${B}${o}`,{...a,headers:{"content-type":"application/json",...a.headers||{},"x-wallet-address":I()}}),_=await h.json().catch(()=>({}));if(!h.ok)throw new Error(_?.error||_?.message||`HTTP ${h.status}`);return _}function P(t){if(!t)return"-";const a=new Date(t);return Number.isFinite(a.getTime())?a.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):String(t)}const p=u("customer"),i=u(!1),n=u(""),c=u(null),f=u([]),v=w(()=>String(b.params?.id||"")),y=w(()=>f.value.map(t=>({id:t.id,wallet:t.wallet,createdAtLabel:P(t.created_at)})));async function D(){try{const t=await g("/api/me");p.value=t?.role||"customer"}catch(t){console.error(t),n.value=t.message||"Gagal mengambil role user"}}async function k(){if(!v.value){n.value="Event ID tidak valid";return}i.value=!0,n.value="";try{const t=await g(`/api/admin/events/${encodeURIComponent(v.value)}/transactions`);c.value=t?.event||null,f.value=Array.isArray(t?.items)?t.items:[]}catch(t){console.error(t),n.value=t.message||"Gagal memuat transaksi"}finally{i.value=!1}}function E(){S.push({name:"admin-dashboard"})}return M(async()=>{await D(),p.value==="admin"&&await k()}),(t,a)=>(l(),s("div",H,[e("header",q,[a[2]||(a[2]=e("div",{class:"brand"},[e("img",{src:W,alt:"Tickety"})],-1)),a[3]||(a[3]=e("div",{class:"topbar-title"},"Admin Dashboard",-1)),e("button",{class:"hamburger",onClick:x(T,["stop"]),"aria-label":"Toggle Sidebar"},[...a[1]||(a[1]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])]),N(C,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value=o)},null,8,["modelValue"]),e("main",G,[e("section",O,[e("div",U,[a[5]||(a[5]=e("p",{class:"badge"},"Admin",-1)),a[6]||(a[6]=e("h1",null,"Detail Pembelian Tiket",-1)),e("p",z,[c.value?.title?(l(),s("span",J,r(c.value.title)+" — ",1)):m("",!0),A(" Event ID: "+r(v.value||"-"),1)]),c.value?.promoter_wallet?(l(),s("p",K,[a[4]||(a[4]=A(" Promoter: ",-1)),e("span",Q,r(c.value.promoter_wallet),1)])):m("",!0)]),e("div",{class:"hero-actions"},[e("button",{class:"btn secondary",type:"button",onClick:E},"Back")])]),p.value==="admin"?(l(),s("section",X,[e("header",Y,[a[7]||(a[7]=e("h2",null,"Pembeli",-1)),e("button",{class:"refresh",onClick:k,disabled:i.value},r(i.value?"Memuat…":"Refresh"),9,Z)]),n.value?(l(),s("p",ee,r(n.value),1)):m("",!0),!i.value&&!n.value&&y.value.length===0?(l(),s("div",te," Belum ada pembelian untuk event ini. ")):(l(),s("div",ae,[e("table",se,[a[8]||(a[8]=e("thead",null,[e("tr",null,[e("th",null,"Waktu Pembelian"),e("th",null,"Wallet Pembeli (MetaMask)")])],-1)),e("tbody",null,[(l(!0),s(L,null,j(y.value,o=>(l(),s("tr",{key:o.id},[e("td",null,r(o.createdAtLabel),1),e("td",le,r(o.wallet),1)]))),128))])])]))])):m("",!0),p.value!=="admin"&&!i.value?(l(),s("section",ne,[...a[9]||(a[9]=[e("p",{class:"error"},"Halaman ini hanya untuk admin.",-1)])])):m("",!0)])]))}},de=$(oe,[["__scopeId","data-v-e5ae7243"]]);export{de as default};
