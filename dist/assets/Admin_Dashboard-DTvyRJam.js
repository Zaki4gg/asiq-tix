import{_ as P,r as _,w as D,c as w,o as N,a as o,b as t,d as $,e as x,f as M,S as V,g as h,t as l,F as W,h as j,u as L,i as r,n as C}from"./index-ojYVKOqh.js";const H={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},F={class:"topbar"},G={class:"container dashboard"},O={key:0,class:"summary-grid"},U={class:"summary-card"},z={class:"value"},q={class:"summary-card"},J={class:"value"},K={class:"summary-card"},Q={class:"value"},X={class:"summary-card"},Y={class:"value"},Z={class:"summary-card"},tt={class:"value"},et={key:1,class:"table-section"},at={class:"table-header"},st=["disabled"],lt={key:0,class:"error"},nt={key:1,class:"empty"},ot={key:2,class:"table-wrapper"},rt={class:"table"},it={class:"cell-title"},dt={class:"title"},ut={class:"sub"},ct={class:"mono"},mt={key:2,class:"forbidden"},pt={__name:"Admin_Dashboard",setup(_t){const S=L(),u=_(!1),R=()=>u.value=!u.value;D(()=>S.fullPath,()=>u.value=!1);const A="http://localhost:3001".replace(/\/+$/,"").replace(/\/api$/i,""),I=()=>(localStorage.getItem("walletAddress")||"").toString();async function f(a,e={}){const s=a.startsWith("/api")?a:`/api${a.startsWith("/")?a:`/${a}`}`,n=await fetch(`${A}${s}`,{...e,headers:{"content-type":"application/json",...e.headers||{},"x-wallet-address":I()}}),i=await n.json().catch(()=>({}));if(!n.ok)throw new Error(i?.error||i?.message||`HTTP ${n.status}`);return i}function v(a){return a?String(Math.round(a)).replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function E(a){if(!a)return"-";const e=new Date(a);return Number.isFinite(e.getTime())?e.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):a}const c=_("customer"),d=_(!1),m=_(""),y=_([]),b=w(()=>y.value.map(a=>{const e=Number(a.sold_tickets||0),s=Number(a.total_tickets||0),n=Number(a.price_idr||0),i=e*n;return{id:a.id,title:a.title,venue:a.venue,dateLabel:E(a.date_iso),sold:e,total:s,remaining:Math.max(s-e,0),priceIdr:n,revenueIdr:i,listed:!!a.listed,promoterWallet:a.promoter_wallet||null}})),p=w(()=>{const a=b.value,e=a.length;let s=0,n=0,i=0,T=0;for(const g of a)s+=g.total,n+=g.sold,i+=g.remaining,T+=g.revenueIdr;return{totalEvents:e,totalTickets:s,totalSold:n,totalRemaining:i,totalRevenueIdr:T}});async function B(){try{const a=await f("/api/me");c.value=a?.role||"customer"}catch(a){console.error(a),m.value=a.message||"Gagal mengambil role user"}}async function k(){d.value=!0,m.value="";try{const a=await f("/api/events?all=1&include_unlisted=1");y.value=Array.isArray(a?.items)?a.items:[]}catch(a){console.error(a),m.value=a.message||"Gagal memuat data event"}finally{d.value=!1}}return N(async()=>{await B(),c.value==="admin"&&await k()}),(a,e)=>(r(),o("div",H,[t("header",F,[e[2]||(e[2]=t("div",{class:"brand"},[t("img",{src:x,alt:"Tickety"})],-1)),e[3]||(e[3]=t("div",{class:"topbar-title"},"Admin Dashboard",-1)),t("button",{class:"hamburger",onClick:M(R,["stop"]),"aria-label":"Toggle Sidebar"},[...e[1]||(e[1]=[t("span",null,null,-1),t("span",null,null,-1),t("span",null,null,-1)])])]),$(V,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s)},null,8,["modelValue"]),t("main",G,[e[12]||(e[12]=t("section",{class:"hero hero--compact"},[t("div",{class:"hero-text"},[t("p",{class:"badge"},"Admin"),t("h1",null,"Ringkasan Penjualan Tiket"),t("p",{class:"muted"},"Pantau performa semua event yang terdaftar di platform.")])],-1)),c.value==="admin"?(r(),o("section",O,[t("article",U,[e[4]||(e[4]=t("p",{class:"label"},"Total Event",-1)),t("p",z,l(p.value.totalEvents),1)]),t("article",q,[e[5]||(e[5]=t("p",{class:"label"},"Total Tiket",-1)),t("p",J,l(p.value.totalTickets),1)]),t("article",K,[e[6]||(e[6]=t("p",{class:"label"},"Tiket Terjual",-1)),t("p",Q,l(p.value.totalSold),1)]),t("article",X,[e[7]||(e[7]=t("p",{class:"label"},"Tiket Tersisa",-1)),t("p",Y,l(p.value.totalRemaining),1)]),t("article",Z,[e[8]||(e[8]=t("p",{class:"label"},"Perkiraan Pendapatan",-1)),t("p",tt," Rp "+l(v(p.value.totalRevenueIdr)||"0"),1)])])):h("",!0),c.value==="admin"?(r(),o("section",et,[t("header",at,[e[9]||(e[9]=t("h2",null,"Detail Event",-1)),t("button",{class:"refresh",onClick:k,disabled:d.value},l(d.value?"Memuatâ€¦":"Refresh"),9,st)]),m.value?(r(),o("p",lt,l(m.value),1)):h("",!0),!d.value&&b.value.length===0?(r(),o("div",nt," Belum ada event yang tercatat. ")):(r(),o("div",ot,[t("table",rt,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Tanggal"),t("th",null,"Terjual / Total"),t("th",null,"Sisa"),t("th",null,"Harga (Rp)"),t("th",null,"Pendapatan (Rp)"),t("th",null,"Status"),t("th",null,"Promoter")])],-1)),t("tbody",null,[(r(!0),o(W,null,j(b.value,s=>(r(),o("tr",{key:s.id},[t("td",null,[t("div",it,[t("div",dt,l(s.title),1),t("div",ut,l(s.venue),1)])]),t("td",null,l(s.dateLabel),1),t("td",null,l(s.sold)+" / "+l(s.total),1),t("td",null,l(s.remaining),1),t("td",null,"Rp "+l(v(s.priceIdr)||"0"),1),t("td",null,"Rp "+l(v(s.revenueIdr)||"0"),1),t("td",null,[t("span",{class:C(["pill",s.listed?"pill--green":"pill--gray"])},l(s.listed?"Listed":"Unlisted"),3)]),t("td",null,[t("span",ct,l(s.promoterWallet||"-"),1)])]))),128))])])]))])):h("",!0),c.value!=="admin"&&!d.value?(r(),o("section",mt,[...e[11]||(e[11]=[t("p",{class:"error"},"Halaman ini hanya untuk admin.",-1)])])):h("",!0)])]))}},vt=P(pt,[["__scopeId","data-v-0bd8feff"]]);export{vt as default};
