import{_ as E,r as i,w as $,c as w,m as R,o as V,a as s,b as e,d as M,e as N,f as W,S as x,g as m,j as C,t as u,F as L,h as j,p as F,q as o}from"./index-DGMigDkt.js";const H={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},q={class:"topbar"},G={class:"container dashboard"},O={class:"hero hero--compact"},U={class:"hero-text"},z={class:"muted"},J={key:0},K={key:0,class:"table-section"},Q={class:"table-header"},X=["disabled"],Y={key:0,class:"error"},Z={key:1,class:"empty"},ee={key:2,class:"table-wrapper"},te={class:"table"},ae={class:"mono"},se={key:1,class:"forbidden"},oe={__name:"Promoter_EventTransactions",setup(le){const _=R(),S=F(),c=i(!1),P=()=>c.value=!c.value;$(()=>_.fullPath,()=>c.value=!1);const T="http://localhost:3001,https://asiqtix-main-production.up.railway.app/".replace(/\/+$/,"").replace(/\/api$/i,""),A=()=>(localStorage.getItem("walletAddress")||"").toString();async function g(t,a={}){const n=t.startsWith("/api")?t:`/api${t.startsWith("/")?t:`/${t}`}`,h=await fetch(`${T}${n}`,{...a,headers:{"content-type":"application/json",...a.headers||{},"x-wallet-address":A()}}),b=await h.json().catch(()=>({}));if(!h.ok)throw new Error(b?.error||b?.message||`HTTP ${h.status}`);return b}function B(t){if(!t)return"-";const a=new Date(t);return Number.isFinite(a.getTime())?a.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):String(t)}const d=i("customer"),r=i(!1),l=i(""),p=i(null),f=i([]),v=w(()=>String(_.params?.id||"")),y=w(()=>f.value.map(t=>({id:t.id,wallet:t.wallet,createdAtLabel:B(t.created_at)})));async function I(){try{const t=await g("/api/me");d.value=t?.role||"customer"}catch(t){console.error(t),l.value=t.message||"Gagal mengambil role user"}}async function k(){if(!v.value){l.value="Event ID tidak valid";return}r.value=!0,l.value="";try{const t=await g(`/api/promoter/events/${encodeURIComponent(v.value)}/transactions`);p.value=t?.event||null,f.value=Array.isArray(t?.items)?t.items:[]}catch(t){console.error(t),l.value=t.message||"Gagal memuat transaksi"}finally{r.value=!1}}function D(){S.push({name:"promoter-dashboard"})}return V(async()=>{await I(),d.value==="promoter"&&await k()}),(t,a)=>(o(),s("div",H,[e("header",q,[a[2]||(a[2]=e("div",{class:"brand"},[e("img",{src:N,alt:"Tickety"})],-1)),a[3]||(a[3]=e("div",{class:"topbar-title"},"Promoter Dashboard",-1)),e("button",{class:"hamburger",onClick:W(P,["stop"]),"aria-label":"Toggle Sidebar"},[...a[1]||(a[1]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])]),M(x,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=n=>c.value=n)},null,8,["modelValue"]),e("main",G,[e("section",O,[e("div",U,[a[4]||(a[4]=e("p",{class:"badge"},"Promoter",-1)),a[5]||(a[5]=e("h1",null,"Detail Pembelian Tiket",-1)),e("p",z,[p.value?.title?(o(),s("span",J,u(p.value.title)+" — ",1)):m("",!0),C(" Event ID: "+u(v.value||"-"),1)])]),e("div",{class:"hero-actions"},[e("button",{class:"btn secondary",type:"button",onClick:D},"Back")])]),d.value==="promoter"?(o(),s("section",K,[e("header",Q,[a[6]||(a[6]=e("h2",null,"Pembeli",-1)),e("button",{class:"refresh",onClick:k,disabled:r.value},u(r.value?"Memuat…":"Refresh"),9,X)]),l.value?(o(),s("p",Y,u(l.value),1)):m("",!0),!r.value&&!l.value&&y.value.length===0?(o(),s("div",Z," Belum ada pembelian untuk event ini. ")):(o(),s("div",ee,[e("table",te,[a[7]||(a[7]=e("thead",null,[e("tr",null,[e("th",null,"Waktu Pembelian"),e("th",null,"Wallet Pembeli (MetaMask)")])],-1)),e("tbody",null,[(o(!0),s(L,null,j(y.value,n=>(o(),s("tr",{key:n.id},[e("td",null,u(n.createdAtLabel),1),e("td",ae,u(n.wallet),1)]))),128))])])]))])):m("",!0),d.value!=="promoter"&&!r.value?(o(),s("section",se,[...a[8]||(a[8]=[e("p",{class:"error"},"Halaman ini hanya untuk promoter.",-1)])])):m("",!0)])]))}},ie=E(oe,[["__scopeId","data-v-9ea711a4"]]);export{ie as default};
