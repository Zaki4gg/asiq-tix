import{_ as N,r as h,w as $,c as S,o as x,a as n,b as t,d as C,e as M,f as V,S as j,g,t as l,F as L,h as H,p as W,m as F,q as r,n as q}from"./index-Db4e0OL_.js";const G={class:"home-page",style:{"--hero-img":"url(/Background.png)"}},O={class:"topbar"},U={class:"container dashboard"},z={key:0,class:"summary-grid"},J={class:"summary-card"},K={class:"value"},Q={class:"summary-card"},X={class:"value"},Y={class:"summary-card"},Z={class:"value"},tt={class:"summary-card"},et={class:"value"},at={class:"summary-card"},st={class:"value"},lt={key:1,class:"table-section"},ot={class:"table-header"},nt=["disabled"],rt={key:0,class:"error"},it={key:1,class:"empty"},ut={key:2,class:"table-wrapper"},dt={class:"table"},ct={class:"cell-title"},mt={class:"title"},pt={class:"sub"},ht=["onClick"],_t={key:2,class:"forbidden"},gt={__name:"Promoter_Dashboard",setup(vt){const T=W(),R=F(),d=h(!1),E=()=>d.value=!d.value;$(()=>R.fullPath,()=>d.value=!1);function I(e){e&&T.push({name:"promoter-event-transactions",params:{id:e}})}const P="http://localhost:3001,https://asiqtix-main-production.up.railway.app/".replace(/\/+$/,"").replace(/\/api$/i,""),D=()=>(localStorage.getItem("walletAddress")||"").toString();async function y(e,a={}){const s=e.startsWith("/api")?e:`/api${e.startsWith("/")?e:`/${e}`}`,o=await fetch(`${P}${s}`,{...a,headers:{"content-type":"application/json",...a.headers||{},"x-wallet-address":D()}}),i=await o.json().catch(()=>({}));if(!o.ok)throw new Error(i?.error||i?.message||`HTTP ${o.status}`);return i}function v(e){return e?String(Math.round(e)).replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function A(e){if(!e)return"-";const a=new Date(e);return Number.isFinite(a.getTime())?a.toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):e}const c=h("customer"),u=h(!1),m=h(""),f=h([]),b=S(()=>f.value.map(e=>{const a=Number(e.sold_tickets||0),s=Number(e.total_tickets||0),o=Number(e.price_idr||0),i=a*o;return{id:e.id,title:e.title,venue:e.venue,dateLabel:A(e.date_iso),sold:a,total:s,remaining:Math.max(s-a,0),priceIdr:o,revenueIdr:i,listed:!!e.listed}})),p=S(()=>{const e=b.value,a=e.length;let s=0,o=0,i=0,w=0;for(const _ of e)s+=_.total,o+=_.sold,i+=_.remaining,w+=_.revenueIdr;return{totalEvents:a,totalTickets:s,totalSold:o,totalRemaining:i,totalRevenueIdr:w}});async function B(){try{const e=await y("/api/me");c.value=e?.role||"customer"}catch(e){console.error(e),m.value=e.message||"Gagal mengambil role user"}}async function k(){u.value=!0,m.value="";try{const e=await y("/api/my-events");f.value=Array.isArray(e?.items)?e.items:[]}catch(e){console.error(e),m.value=e.message||"Gagal memuat data event"}finally{u.value=!1}}return x(async()=>{await B(),c.value==="promoter"&&await k()}),(e,a)=>(r(),n("div",G,[t("header",O,[a[2]||(a[2]=t("div",{class:"brand"},[t("img",{src:M,alt:"Tickety"})],-1)),a[3]||(a[3]=t("div",{class:"topbar-title"},"Promoter Dashboard",-1)),t("button",{class:"hamburger",onClick:V(E,["stop"]),"aria-label":"Toggle Sidebar"},[...a[1]||(a[1]=[t("span",null,null,-1),t("span",null,null,-1),t("span",null,null,-1)])])]),C(j,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value=s)},null,8,["modelValue"]),t("main",U,[a[12]||(a[12]=t("section",{class:"hero hero--compact"},[t("div",{class:"hero-text"},[t("p",{class:"badge"},"Promoter"),t("h1",null,"Penjualan Tiket Event Saya"),t("p",{class:"muted"},"Data hanya untuk event yang dibuat dengan wallet ini.")])],-1)),c.value==="promoter"?(r(),n("section",z,[t("article",J,[a[4]||(a[4]=t("p",{class:"label"},"Event Saya",-1)),t("p",K,l(p.value.totalEvents),1)]),t("article",Q,[a[5]||(a[5]=t("p",{class:"label"},"Total Tiket",-1)),t("p",X,l(p.value.totalTickets),1)]),t("article",Y,[a[6]||(a[6]=t("p",{class:"label"},"Tiket Terjual",-1)),t("p",Z,l(p.value.totalSold),1)]),t("article",tt,[a[7]||(a[7]=t("p",{class:"label"},"Tiket Tersisa",-1)),t("p",et,l(p.value.totalRemaining),1)]),t("article",at,[a[8]||(a[8]=t("p",{class:"label"},"Perkiraan Pendapatan",-1)),t("p",st,"Rp "+l(v(p.value.totalRevenueIdr)||"0"),1)])])):g("",!0),c.value==="promoter"?(r(),n("section",lt,[t("header",ot,[a[9]||(a[9]=t("h2",null,"Event Saya",-1)),t("button",{class:"refresh",onClick:k,disabled:u.value},l(u.value?"Memuatâ€¦":"Refresh"),9,nt)]),m.value?(r(),n("p",rt,l(m.value),1)):g("",!0),!u.value&&b.value.length===0?(r(),n("div",it," Belum ada event yang dimiliki oleh wallet ini. ")):(r(),n("div",ut,[t("table",dt,[a[10]||(a[10]=t("thead",null,[t("tr",null,[t("th",null,"Event"),t("th",null,"Tanggal"),t("th",null,"Terjual / Total"),t("th",null,"Sisa"),t("th",null,"Harga (Rp)"),t("th",null,"Pendapatan (Rp)"),t("th",null,"Status"),t("th",null,"Aksi")])],-1)),t("tbody",null,[(r(!0),n(L,null,H(b.value,s=>(r(),n("tr",{key:s.id},[t("td",null,[t("div",ct,[t("div",mt,l(s.title),1),t("div",pt,l(s.venue),1)])]),t("td",null,l(s.dateLabel),1),t("td",null,l(s.sold)+" / "+l(s.total),1),t("td",null,l(s.remaining),1),t("td",null,"Rp "+l(v(s.priceIdr)||"0"),1),t("td",null,"Rp "+l(v(s.revenueIdr)||"0"),1),t("td",null,[t("span",{class:q(["pill",s.listed?"pill--green":"pill--gray"])},l(s.listed?"Listed":"Unlisted"),3)]),t("td",null,[t("button",{class:"btn-detail",type:"button",onClick:o=>I(s.id)}," Detail ",8,ht)])]))),128))])])]))])):g("",!0),c.value!=="promoter"&&!u.value?(r(),n("section",_t,[...a[11]||(a[11]=[t("p",{class:"error"},"Halaman ini hanya untuk promoter.",-1)])])):g("",!0)])]))}},ft=N(gt,[["__scopeId","data-v-1e020604"]]);export{ft as default};
